<!--正文部分-->

<div class="row no-gutters" id="subtitle">
    {{range $index, $value := .Subtitles}}
    <div class="col-sm-12 col-md-6 col-lg-4 pb-1 pl-1 subtitle-container">
        <div class="card">
            <div class="text-white text-center">
                <p class="subtitle-title-zh m-1">{{$value.NameZh}}</p>
                <p class="subtitle-title-en mx-1 mb-1">{{$value.NameEn}}</p>
            </div>
            <div class="subtitle-item">
                <div class="row d-flex align-items-center h-100">

                    <ul class="col-9 mb-0">
                        <li>
                            <span class="fa fa-calendar align-middle" title="发布时间 publiced time"></span>
                            <small class="align-middle"> {{$value.HumamTime}}</small>
                        </li>
                        <li>
                            <span class="fa fa-language align-middle" title="subtitle language 字幕语言"></span>
                            <small class="align-middle"> {{$value.Lang}}</small>
                        </li>
                        <li>
                            <span class="fa fa-map-o align-middle" title="format 字幕格式"></span>
                            <small class="align-middle"> {{$value.Format}}</small>
                        </li>
                        <li class="text-truncate">
                            <span class="fa fa-file-video-o align-middle" title="fit video file name 字幕对应的文件名称"></span>
                            <small class="align-middle "> {{$value.FileName}}</small>
                        </li>
                    </ul>
                    <div class="col-3 text-center">
                        <a class="subtitle align-middle" href="{{$value.OssUrl}}" download="{{$value.FileName}}">
                            <span class="fa fa-download"></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{end}}
</div>

<!--加载更多按钮-->
<button type="button" id="load-more" class="btn stylish-color btn-block waves-effect waves-light mb-3">加载更多</button>
<script>
    function setSubtilteWithColor(){
        var colorClasses = ['danger-color', 'orange', 'primary-color', 'success-color', 'info-color', 'warning-color', 'default-color'];
        var count = colorClasses.length;
        $('#subtitle > div.subtitle-container >div.card >div.text-white.text-center').removeClass(colorClasses[0]).addClass(function (idx, classString) {
            return colorClasses[idx%count];
        });
    }
    setSubtilteWithColor();



    /*初始化*/
    var offset = 30; /*offset*/
    var size = 18;
    function fillJsonDataIntoDomeNode(subObj) {

        cloneNode = $(' #subtitle > div.subtitle-container:first').clone();

        cloneNode.find('p.subtitle-title-zh').text(subObj.NameZh);
        cloneNode.find('p.subtitle-title-en').text(subObj.NameEn);
        cloneNode.find('ul.col-9 > li:nth-child(1) > small').text(subObj.HumamTime)
        cloneNode.find('ul.col-9 > li:nth-child(2) > small').text(subObj.Lang)
        cloneNode.find('ul.col-9 > li:nth-child(3) > small').text(subObj.Format)
        cloneNode.find('ul.col-9 > li:nth-child(4) > small').text(subObj.FileName)
        cloneNode.find('a.subtitle').attr('href',subObj.OssUrl).attr('download',subObj.FileName)
        $('div.row.no-gutters').append(cloneNode);
    }
    function getData() {
        $.post('/subtitle/load-more', { offset: offset, size: size }, function (reponse,textStatus) {
            if (textStatus == 'success'){
                var list = reponse.data;
                $(list).each(function (idx, jsonEle) {
                    offset++;
                    fillJsonDataIntoDomeNode(jsonEle);
                });
                /*******************************************/
                setSubtilteWithColor();
                /*隐藏more按钮*/
                $('#load-more').show();
            }else {
                alert('验证过期,请重刷新,页面在点击加载更多');
            }
        });
    }
    $('#load-more').click(function () {
        $(this).hide();
        getData();
    });

</script>